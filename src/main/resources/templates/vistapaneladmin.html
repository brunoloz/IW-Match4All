<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <th:block th:replace="~{fragments/head :: header}" />
    <title>IW: Match4All - Panel Admin</title>
</head>

<body>
    <header th:replace="~{fragments/nav.html :: nav}"></header>

    <main class="container py-4">
        <div class="mx-auto" style="max-width: 1100px;">
            <div class="mb-4">
                <h1 class="h3 mb-3">Panel de Administración</h1>
                <div class="d-flex gap-2 flex-wrap position-relative">
                    <div class="flex-grow-1 position-relative" style="min-width: 280px;">
                        <input id="global-search" type="text" class="form-control" placeholder="Buscar ligas, equipos o jugadores...">
                    </div>
                    <button id="btn-create-comp" type="button" class="btn btn-primary">Crear Competición</button>
                    <button id="btn-matchmaking" type="button" class="btn btn-success">Iniciar Matchmaking</button>
                </div>
            </div>

            <div class="mt-4">
                <section class="card shadow-sm mb-3">
                    <div class="card-header">
                        <h3 class="h5 mb-0">Competiciones Activas</h3>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0 align-middle">
                                <thead class="table-light">
                                    <tr>
                                        <th>Nombre</th>
                                        <th>Tipo</th>
                                        <th>Equipos</th>
                                        <th>Estado</th>
                                    </tr>
                                </thead>
                                <tbody id="competitions-body"></tbody>
                            </table>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <th:block th:replace="~{fragments/footer.html :: footer}" />

    <script>
        (() => {
            const competitions = [
                { id: 1, name: 'Liga Match4All - Primera', type: 'Liga', teams: '12/16', status: 'En curso' },
                { id: 2, name: 'Copa Match4All', type: 'Copa', teams: '8/16', status: 'Inscripción' }
            ];

            const competitionsBody = document.getElementById('competitions-body');
            const searchInput = document.getElementById('global-search');
            const createCompetitionButton = document.getElementById('btn-create-comp');
            const matchmakingButton = document.getElementById('btn-matchmaking');

            const renderCompetitions = () => {
                const query = searchInput.value.trim().toLowerCase();
                const filtered = competitions.filter((competition) => {
                    return competition.name.toLowerCase().includes(query) || competition.type.toLowerCase().includes(query);
                });

                competitionsBody.innerHTML = '';

                if (filtered.length === 0) {
                    const row = document.createElement('tr');
                    row.innerHTML = '<td colspan="4" class="text-muted">No hay competiciones para mostrar.</td>';
                    competitionsBody.appendChild(row);
                    return;
                }

                filtered.forEach((competition) => {
                    const statusBadge = competition.status === 'En curso' ? 'text-bg-success' : 'text-bg-primary';
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${competition.name}</td>
                        <td>${competition.type}</td>
                        <td>${competition.teams}</td>
                        <td><span class="badge ${statusBadge}">${competition.status}</span></td>
                    `;
                    competitionsBody.appendChild(row);
                });
            };

            createCompetitionButton.addEventListener('click', () => {
                competitions.push({
                    id: Date.now(),
                    name: 'Torneo Relámpago Demo',
                    type: 'Torneo',
                    teams: '0/8',
                    status: 'Inscripción'
                });
                renderCompetitions();
            });

            matchmakingButton.addEventListener('click', () => {
                const competition = competitions.find((item) => item.status === 'Inscripción');
                if (!competition) {
                    alert('No hay competiciones en inscripción para emparejar.');
                    return;
                }

                competition.status = 'En curso';
                renderCompetitions();
            });

            searchInput.addEventListener('input', renderCompetitions);
            renderCompetitions();
        })();
    </script>
</body>

</html>